<template>
  <div>
    <canvas :id="canvasId" class="canvas-style" v-on:mousedown="mouseDown" />
  </div>
</template>

<script>
// TODO: move all of this logic to master
// packages
const paper = require("paper");
const pathZ = `["Path",{"applyMatrix":true,"segments":[[558,232],[558,231],[557,231],[556,231],[555,231],[554,231],[554,230],[553,230],[552,230],[551,230],[550,230],[549,230],[548,230],[547,230],[546,230],[545,230],[544,229],[543,229],[542,229],[541,229],[540,229],[539,229],[538,229],[537,229],[536,229],[535,229],[534,229],[533,229],[532,229],[531,229],[530,229],[529,229],[529,228],[528,228],[527,228],[526,228],[525,228],[524,228],[523,228],[522,228],[521,228],[520,228],[519,229],[518,229],[518,230],[517,230],[516,230],[516,231],[515,231],[514,231],[514,232],[513,232],[513,233],[512,233],[511,233],[511,234],[510,234],[509,234],[509,235],[508,235],[508,236],[507,236],[506,236],[505,237],[504,238],[503,238],[502,239],[501,240],[500,240],[500,241],[499,241],[499,242],[498,242],[498,243],[497,243],[497,244],[496,244],[496,245],[495,246],[495,247],[494,247],[494,248],[494,249],[494,250],[493,250],[493,251],[493,252],[493,253],[492,254],[492,255],[492,256],[492,257],[492,258],[491,259],[491,260],[491,261],[491,262],[491,263],[491,264],[491,265],[491,266],[491,267],[491,268],[492,268],[492,269],[492,270],[493,270],[493,271],[494,271],[494,272],[495,273],[495,274],[496,274],[496,275],[497,275],[497,276],[498,276],[498,277],[499,277],[500,278],[500,279],[501,279],[501,280],[502,280],[503,280],[503,281],[504,281],[504,282],[505,282],[505,283],[506,283],[506,284],[507,284],[508,285],[509,285],[509,286],[510,286],[510,287],[511,287],[511,288],[512,288],[513,288],[513,289],[514,289],[514,290],[515,290],[516,291],[517,291],[518,292],[519,292],[520,292],[520,293],[521,293],[522,293],[522,294],[523,294],[524,294],[525,294],[526,294],[526,295],[527,295],[528,295],[529,295],[530,295],[531,295],[532,295],[533,295],[534,295],[535,295],[536,295],[537,295],[538,295],[539,295],[540,295],[541,295],[542,295],[543,295],[544,295],[545,295],[546,295],[547,295],[548,295],[549,295],[550,295],[550,294],[551,294],[552,294],[552,293],[553,293],[554,293],[555,292],[556,292],[556,291],[557,291],[557,290],[558,290],[559,290],[559,289],[560,289],[560,288],[561,288],[561,287],[562,287],[562,286],[563,286],[563,285],[564,285],[564,284],[565,284],[565,283],[566,283],[566,282],[567,282],[567,281],[568,281],[568,280],[568,279],[569,279],[569,278],[569,277],[570,277],[570,276],[570,275],[570,274],[570,273],[570,272],[570,271],[570,270],[570,269],[570,268],[570,267],[570,266],[570,265],[570,264],[569,264],[569,263],[569,262],[569,261],[569,260],[569,259],[569,258],[569,257],[568,257],[568,256],[568,255],[568,254],[568,253],[567,253],[567,252],[567,251],[566,250],[566,249],[566,248],[566,247],[566,246],[565,245],[565,244],[565,243],[565,242],[564,242],[564,241],[564,240],[564,239],[563,239],[563,238],[563,237],[563,236],[563,235],[562,235],[562,235]],"strokeColor":[0,0,0],"strokeWidth":1.5,"strokeJoin":"round"}]`;

export default {
  name: "Canvas",
  props: ["canvasId"],
  data: () => ({
    path: null,
    scope: null,
  }),
  methods: {
    reset() {
      this.scope.project.activeLayer.removeChildren();
    },
    pathCreate(scope) {
      scope.activate();
      return new paper.Path({
        strokeColor: "#000000",
        strokeJoin: "round",
        strokeWidth: 10,
      });
    },
    createTool(scope) {
      scope.activate();
      return new paper.Tool();
    },
    mouseDown() {
      // in order to access functions in nested tool
      let self = this;
      // create drawing tool
      this.tool = this.createTool(this.scope);
      this.tool.onMouseDown = (event) => {
        // init path
        self.path = self.pathCreate(self.scope);
        // add point to path
        self.path.add(event.point);
      };
      this.tool.onMouseDrag = (event) => {
        self.path.add(event);
      };
      this.tool.onMouseUp = (event) => {
        // line completed
        self.path.add(event.point);
        console.log(self.path.exportJSON());
        self.path.importJSON(pathZ);
      };
    },
  },
  mounted() {
    this.scope = new paper.PaperScope();
    this.scope.setup(this.canvasId);
  },
};
</script>

<style scoped>
.canvas-style {
  cursor: crosshair;
  width: 100% !important;
  height: 500px !important;
  border: 5px solid black;
  border-radius: 10px;
  display: block;
  margin: auto;
  box-shadow: 0 10px 8px -8px black;
}
</style>
