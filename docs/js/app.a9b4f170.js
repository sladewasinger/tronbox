(function(){var t={9648:function(t,e,i){"use strict";var o=i(9242),n=i(3396);function r(t,e,i,o,r,s){const a=(0,n.up)("TronBox");return(0,n.wg)(),(0,n.j4)(a,{"canvas-id":"grid"})}var s=i(7139);const a=t=>((0,n.dD)("data-v-4a277c6b"),t=t(),(0,n.Cn)(),t),d={class:"grid-box"},l=a((()=>(0,n._)("div",{class:"header"},[(0,n._)("h1",null,"Battle Tron")],-1))),c={class:"flex-box-row"},h={class:"flex-box-row no-gap"},u=a((()=>(0,n._)("p",{class:"tip"}," Press 'a' or 'b' on the keyboard to place a bot at your mouse position! ",-1))),v=["id"],p={class:"winner-box"},f=a((()=>(0,n._)("h2",null,"Points:",-1))),g={key:0},b={class:"editor"},w={class:"controls"},m={class:"multi-control"},y={class:"multi-control"};function x(t,e,i,r,a,x){return(0,n.wg)(),(0,n.iD)("div",d,[l,(0,n._)("div",c,[(0,n._)("div",h,[(0,n._)("div",null,[u,(0,n._)("canvas",{id:i.canvasId,ref:"canvas",width:"500",class:"canvas-style",height:"500",onMousemove:e[0]||(e[0]=(...t)=>x.mouseMove&&x.mouseMove(...t)),onMouseenter:e[1]||(e[1]=(...t)=>x.canvasMouseEnter&&x.canvasMouseEnter(...t)),onMouseleave:e[2]||(e[2]=(...t)=>x.canvasMouseLeave&&x.canvasMouseLeave(...t))},null,40,v)]),(0,n._)("div",p,[f,x.showWinnerText?((0,n.wg)(),(0,n.iD)("ol",g,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.engine.winners,(t=>((0,n.wg)(),(0,n.iD)("li",{key:t.id},[(0,n._)("b",{style:(0,s.j5)(`color: ${t.color}`)},"TRAIL ["+(0,s.zw)(t.id)+"]",5),(0,n.Uk)(" - POINTS: "+(0,s.zw)(t.points),1)])))),128))])):(0,n.kq)("",!0)])]),(0,n._)("div",b,[(0,n._)("div",w,[(0,n._)("div",m,[(0,n._)("button",{class:"btn btn-dark",onClick:e[3]||(e[3]=e=>x.addBot(t.botA))},"ADD [A]"),(0,n.wy)((0,n._)("input",{id:"colorPickerA","onUpdate:modelValue":e[4]||(e[4]=e=>t.botA.color=e),type:"color"},null,512),[[o.nr,t.botA.color]]),(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":e[5]||(e[5]=e=>t.botA.posTxt=e),type:"text",class:"pos-input"},null,512),[[o.nr,t.botA.posTxt]])]),(0,n._)("div",y,[(0,n._)("button",{class:"btn btn-dark",onClick:e[6]||(e[6]=e=>x.addBot(t.botB))},"ADD [B]"),(0,n.wy)((0,n._)("input",{id:"colorPickerB","onUpdate:modelValue":e[7]||(e[7]=e=>t.botB.color=e),type:"color"},null,512),[[o.nr,t.botB.color]]),(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":e[8]||(e[8]=e=>t.botB.posTxt=e),type:"text",class:"pos-input"},null,512),[[o.nr,t.botB.posTxt]])]),(0,n._)("button",{class:"btn btn-dark",onClick:e[9]||(e[9]=(...t)=>x.clear&&x.clear(...t))},"CLEAR"),(0,n._)("button",{class:"btn btn-dark",onClick:e[10]||(e[10]=(...t)=>x.randomizeBots&&x.randomizeBots(...t))},"RANDOM"),(0,n._)("button",{class:"btn btn-dark",onClick:e[11]||(e[11]=(...t)=>x.togglePause&&x.togglePause(...t))},(0,s.zw)(x.pauseBtnText),1),(0,n._)("button",{class:"btn btn-dark",onClick:e[12]||(e[12]=(...t)=>x.step&&x.step(...t))},"STEP"),(0,n._)("button",{class:"btn btn-dark",onClick:e[13]||(e[13]=(...t)=>x.benchmark&&x.benchmark(...t))},"BENCHMARK")]),(0,n.wy)((0,n._)("textarea",{"onUpdate:modelValue":e[14]||(e[14]=e=>t.botA.js=e),class:"code-area",style:(0,s.j5)(`border-color: ${t.botA.color}`)},null,4),[[o.nr,t.botA.js]]),(0,n.wy)((0,n._)("textarea",{"onUpdate:modelValue":e[15]||(e[15]=e=>t.botB.js=e),class:"code-area",style:(0,s.j5)(`border-color: ${t.botB.color}`)},null,4),[[o.nr,t.botB.js]])])])])}i(2262),i(4506);var P=i(9782);class M{constructor(){}static isOccupied(t,e){if(t&&t.length&&t[0].length&&!(e.x>=t.length||e.x<0||e.y<0||!t[e.x]||e.y>=t[e.x].length))return!!t[e.x][e.y].occupied}static flatten(t){return t.map(((t,e)=>t.map(((t,i)=>(t.gridPosition=new Point(e,i),t))))).flatMap((t=>t))}static getRandomValidPos(t){var e=M.flatten(t).filter((t=>!t.occupied));if(!(e.length<1)){var i=e[Math.floor(Math.random()*e.length)].gridPosition;return i}console.log("No open spots to spawn in a tron bike!")}}const T=i(5445);class B{constructor(t){this.canvasId=t,this.reset()}reset(){T.project?.activeLayer?.removeChildren(),T.projects.forEach((t=>{t.remove()})),T.setup(this.canvasId),this.grid=void 0,this.trailStuff={},this.colors=["#A72334","#FC7A43","#ECCF39","#6FAF60","#02654B","#188DBF","#22379B","#7209b7","#f72585"],this.colorIndex=0}convertMousePosToGridPos(t){if(this.grid){var e=M.flatten(this.grid).find((e=>e.hitTest(new P.Point(t.x,t.y))));return e?e.gridPosition:void 0}}render(t){let e=t.grid,i=t.trails;if(!e.expired){if(void 0===this.grid){var o=50;this.grid=e.map(((t,e)=>t.map(((t,i)=>{var n=new T.Path.Rectangle(new T.Point(e*o,i*o),new T.Size(o,o));return n.strokeColor="#444",n.fillColor="#090909",n}))))}for(let t of i){this.trailStuff[t.id]||(this.trailStuff[t.id]={});let e=this.trailStuff[t.id];for(let n of t.tail){let e=this.grid[n.x][n.y];e.fillColor=t.color,e.strokeWidth=1,e.shadowColor="#000",e.shadowBlur=10}e.wireframe||(e.wireframe=new T.Path([...t.tail,t.head].map((t=>this.grid[t.x][t.y].position))),e.wireframe.strokeColor=new T.Color(0,0,0,.25),e.wireframe.strokeWidth=5),e.wireframe.segments.at(-1).x!=t.head.x&&e.wireframe.segments.at(-1).y!=t.head.y&&e.wireframe.add(this.grid[t.head.x][t.head.y].position);let i=this.grid[t.head.x][t.head.y];i.strokeColor=t.color,i.fillColor=t.color,i.strokeWidth=10,i.shadowColor="#000",i.shadowBlur=20,i.bringToFront();let o=e.headIndicator;if(o||(o=new T.Path.Circle(i.position,15),o.fillColor=t.color,o.strokeColor="#FFF",o.strokeWidth=10,e.headIndicator=o),!t.alive&&!e.deadSymbolHead){o.remove();let t=new T.Path.RegularPolygon(i.position,3,25);t.fillColor="#000",t.position=i.position,e.deadSymbolHead=t}e.wireframe.bringToFront(),o.bringToFront(),o.position=i.position,e.deadSymbolHead?.bringToFront()}}}}class C{constructor(t=0,e=0){this.x=+t,this.y=+e}add(t){return new C(this.x+t.x,this.y+t.y)}}const k={colors:["#A72334","#FC7A43","#ECCF39","#6FAF60","#02654B","#188DBF","#22379B","#7209b7","#f72585"],MoveDirection:{UP:new C(0,-1),DOWN:new C(0,1),LEFT:new C(-1,0),RIGHT:new C(1,0)}};class A{constructor(t,e,i,o){this.head=t,this.tail=[],this.color=e,this.id=i,this.getMove=o,this.alive=!0,this.state={}}applyMove(t){this.tail.push(this.head),this.head=t}}class O{static getRandomColorHex(){const t=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;function e(t,e,i){i/=100;const o=e*Math.min(i,1-i)/100,n=e=>{const n=(e+t/30)%12,r=i-o*Math.max(Math.min(n-3,9-n,1),-1);return Math.round(255*r).toString(16).padStart(2,"0")};return`#${n(0)}${n(8)}${n(4)}`}var i=t(0,360),o=t(50,100),n=t(30,70);return e(i,o,n)}}class I{static isValidMove(t,e,i,o){if(!i||void 0==i.x||void 0==i.y)return[!1,["Error - moveDir is not a valid Point object. Killing trail. moveDir supplied:",i]];if(!Object.keys(Constants.MoveDirection).map((t=>Constants.MoveDirection[t])).some((t=>i.x==t.x&&i.y==t.y)))return[!1,["Invalid move supplied! Killing trail. Move supplied: ",i]];let n=new C(e.head.x+i.x,e.head.y+i.y);if(n.x<0||n.x>=t.length||n.y<0||n.y>=t[n.x].length)return[!1,[`%cTRAIL [${e.id}] %ctried to escape the grid! They failed...`,"color: "+e.color,"color: auto"]];if(t[n.x][n.y].occupied){var r=t[n.x][n.y].id,s=o.find((t=>t.id==r));return[!1,[`%cTRAIL [${e.id}] %chit %cTRAIL [${s.id}]`,"color: "+e.color,"color: auto","color: "+s.color]]}return[!0]}}class _{constructor(){window.Constants=k,window.Point=P.Point,window.Grid=M,this.reset()}log(){this.debug&&console.log(...arguments)}reset(){this.debug=!0,this.expired=!1,this.path=null,this.point={x:0,y:0},this.grid=void 0,this.trails=[],this.gridWidth=10,this.colorIndex=0,this.winners=[],this.createGrid()}get allBotsDead(){return this.trails.length&&this.trails.every((t=>!t.alive))}createGrid(){this.grid=[];for(var t=0;t<this.gridWidth;t++){this.grid[t]=[];for(var e=0;e<this.gridWidth;e++){var i={id:void 0,get occupied(){return void 0!=this.id}};this.grid[t].push(i)}}}parseRawJsIntoGetMoveFunction(t){let e=new Function("return getMove; "+t)();return e}addTrail(t,e,i,o){if(this.expired)this.log("Engine has expired - please reset before addinga new bot.");else if(o=o||M.getRandomValidPos(this.grid),o){i=i||O.getRandomColorHex();var n=new A(o,i,e,t);this.trails.push(n),this.setGridCellOwner(n)}}setGridCellOwner(t){this.grid[t.head.x][t.head.y].id=t.id}determineWinners(){if(this.trails.length<1)return;var t=M.flatten(this.grid).filter((t=>t.occupied)).reduce(((t,e)=>(t.has(e.id)||t.set(e.id,{points:0,trail:this.trails.find((t=>t.id==e.id))}),t.get(e.id).points+=1,t)),new Map);if(t.size<1)return void this.log("No winners??");let e=Array.from(t.values()).sort(((t,e)=>e.points-t.points));for(var i of(this.log("\n\n\n"),this.log("#############################"),this.log("##         WINNERS         ##"),this.log("#############################"),e)){let t=i.trail;t.points=i.points,this.log(`%c > %cTRAIL [${t.id}] %c POINTS: ${t.points}`,"color: auto",`color: ${t.color};`,"color: auto"),this.winners.push(t)}this.expired=!0}iterateTrails(){for(let i of this.trails.filter((t=>t.alive))){try{var t=i.getMove(this.grid,i.head,this.trails.map((t=>t.head)),i.state)}catch(e){this.log("Error executing script: ",e,i.getMove)}let[o,n]=I.isValidMove(this.grid,i,t,this.trails);if(!o){i.alive=!1,this.log(...n);continue}let r=i.head.add(t);i.applyMove(r),this.setGridCellOwner(i)}}step(){this.expired||this.allBotsDead||this.iterateTrails(),!this.expired&&this.allBotsDead&&this.determineWinners()}}var F="// Clockwise bot - Example:\nfunction getMove(grid, headPos, heads, state) {\n  var dir = Constants.MoveDirection;\n  if (validMove(grid, headPos, dir.RIGHT)) return dir.RIGHT;\n  if (validMove(grid, headPos, dir.DOWN)) return dir.DOWN;\n  if (validMove(grid, headPos, dir.LEFT)) return dir.LEFT;\n  if (validMove(grid, headPos, dir.UP)) return dir.UP;\n  return dir.RIGHT;\n}\n\nfunction validMove(grid, headPos, move) {\n  var nextPos = new Point(headPos.x + move.x, headPos.y + move.y);\n  var isOccupied = Grid.isOccupied(grid, nextPos);\n  return isOccupied == false; // this works because isOccupied is \n  //    exactly false if the square is free, \n  //    true if occupied, \n  //    undefined if out of bounds\n}",R="// Counter-Clockwise bot - Example:\nfunction getMove(grid, headPos, heads, state) {\n  var dir = Constants.MoveDirection;\n  if (validMove(grid, headPos, dir.LEFT)) return dir.LEFT;\n  if (validMove(grid, headPos, dir.DOWN)) return dir.DOWN;\n  if (validMove(grid, headPos, dir.RIGHT)) return dir.RIGHT;\n  if (validMove(grid, headPos, dir.UP)) return dir.UP;\n  return dir.RIGHT;\n}\n\nfunction validMove(grid, headPos, move) {\n  var nextPos = new Point(headPos.x + move.x, headPos.y + move.y);\n  var isOccupied = Grid.isOccupied(grid, nextPos);\n  return isOccupied == false; // this works because isOccupied is \n  //    exactly false if the square is free, \n  //    true if occupied, \n  //    undefined if out of bounds\n}",E={name:"TronBox",props:{canvasId:{type:String,required:!0}},data:()=>({botA:{js:void 0,color:"#FF0000",prevColor:"#FF0000",posTxt:"0,0",id:"A"},botB:{js:void 0,color:"#0000FF",prevColor:"#0000FF",posTxt:"9,9",id:"B"},renderer:void 0,engine:void 0,paused:!0,mousePos:{x:0,y:0},mouseIsOnCanvas:!1,lastKeyPressed:void 0}),computed:{pauseBtnText:function(){return this.paused?"PLAY":"PAUSE"},showWinnerText:function(){return this.engine?.winners?.length>0}},mounted(){window.addEventListener("keydown",this.keyDown),window.addEventListener("keyup",this.keyUp),this.renderer=new B(this.canvasId),this.engine=new _,this.botA.js=F,this.botB.js=R,this.start()},methods:{convertPosTxtToPoint(t){let[e,i,o]=t.match(/(\d+),(\d+)/);return new C(i,o)},addBot(t,e){let i=this.engine.parseRawJsIntoGetMoveFunction(t.js);e=e||this.convertPosTxtToPoint(t.posTxt),this.engine.addTrail(i,t.id,t.color,e)},clear(){this.engine.reset(),this.renderer.reset()},step(){this.engine.step()},randomizeBots(){this.clear(),this.randomizeBot(this.botA),this.randomizeBot(this.botB),this.addInitialTrails()},randomizeBot(t){let e=()=>Math.floor(10*Math.random());t.posTxt=e()+","+e()},addInitialTrails(){this.addBot(this.botA),this.addBot(this.botB)},start(){this.addInitialTrails(),this.loop()},togglePause(){this.paused=!this.paused},canvasMouseEnter(){this.mouseIsOnCanvas=!0},canvasMouseLeave(){this.mouseIsOnCanvas=!1},addBotAtMousePos(t){if(this.mouseIsOnCanvas){var e=this.renderer.convertMousePosToGridPos(this.mousePos);e&&!Grid.isOccupied(this.engine.grid,e)&&this.addBot(t,e)}},keyDown(t){this.lastKeyPressed!=t.key&&(this.lastKeyPressed=t.key,"a"==t.key?this.addBotAtMousePos(this.botA):"b"==t.key&&this.addBotAtMousePos(this.botB))},keyUp(t){this.lastKeyPressed=void 0},mouseMove(t){var e=this.$refs.canvas.getBoundingClientRect();this.mousePos={x:Math.floor(t.clientX-e.left),y:Math.floor(t.clientY-e.top)}},loop(){this.paused||this.engine.step(),this.renderer.render(this.engine),setTimeout(this.loop,50)},async benchmark(){window.BENCHMARK_MAX_ITERATIONS||(window.BENCHMARK_MAX_ITERATIONS=100);let t=window.BENCHMARK_MAX_ITERATIONS,e=new Map;for(let s=1;s<=t;s++){this.randomizeBots(),this.engine.debug=!1;let i=this.botA;this.botA=this.botB,this.botB=i;while(!this.engine.expired)await new Promise((t=>{this.engine.step(),t()}));let o=this.engine.winners.filter((t=>t.points==this.engine.winners[0].points));for(let t of o)e.has(t.id)||e.set(t.id,{...t,wins:0}),1==o.length&&e.get(t.id).wins++;console.log(`Running iteration ${s}/${t}`)}console.log("================="),console.log("BENCHMARK RESULTS:");let i=e.get(this.botA.id).wins,o=e.get(this.botB.id).wins,n=(i/t*100).toFixed(1),r=(o/t*100).toFixed(1);console.log(`Bot A wins: ${i}/${t} (${n}%)`),console.log(`Bot B wins: ${o}/${t} (${r}%)`),console.log("      Ties: ",t-(i+o)),this.engine.debug=!0}}},D=i(89);const S=(0,D.Z)(E,[["render",x],["__scopeId","data-v-4a277c6b"]]);var j=S,$={name:"App",components:{TronBox:j}};const G=(0,D.Z)($,[["render",r]]);var N=G;i(8937);(0,o.ri)(N).mount("#app")},858:function(){},4158:function(){}},e={};function i(o){var n=e[o];if(void 0!==n)return n.exports;var r=e[o]={exports:{}};return t[o].call(r.exports,r,r.exports,i),r.exports}i.m=t,function(){var t=[];i.O=function(e,o,n,r){if(!o){var s=1/0;for(c=0;c<t.length;c++){o=t[c][0],n=t[c][1],r=t[c][2];for(var a=!0,d=0;d<o.length;d++)(!1&r||s>=r)&&Object.keys(i.O).every((function(t){return i.O[t](o[d])}))?o.splice(d--,1):(a=!1,r<s&&(s=r));if(a){t.splice(c--,1);var l=n();void 0!==l&&(e=l)}}return e}r=r||0;for(var c=t.length;c>0&&t[c-1][2]>r;c--)t[c]=t[c-1];t[c]=[o,n,r]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};i.O.j=function(e){return 0===t[e]};var e=function(e,o){var n,r,s=o[0],a=o[1],d=o[2],l=0;if(s.some((function(e){return 0!==t[e]}))){for(n in a)i.o(a,n)&&(i.m[n]=a[n]);if(d)var c=d(i)}for(e&&e(o);l<s.length;l++)r=s[l],i.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return i.O(c)},o=self["webpackChunktronbox"]=self["webpackChunktronbox"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=i.O(void 0,[998],(function(){return i(9648)}));o=i.O(o)})();
//# sourceMappingURL=app.a9b4f170.js.map