(function(){var t={1307:function(t,e,o){"use strict";var i=o(9242),n=o(3396);function r(t,e,o,i,r,s){const a=(0,n.up)("TronBox");return(0,n.wg)(),(0,n.j4)(a,{"canvas-id":"grid"})}var s=o(7139);const a=t=>((0,n.dD)("data-v-a7db633e"),t=t(),(0,n.Cn)(),t),d={class:"grid-box"},l=a((()=>(0,n._)("div",{class:"header"},[(0,n._)("h1",null,"Battle Tron")],-1))),c={class:"flex-box-row"},h={class:"flex-box-row no-gap"},u=a((()=>(0,n._)("p",{class:"tip"}," Press 'a' or 'b' on the keyboard to place a bot at your mouse position! ",-1))),v=["id"],p={class:"winner-box"},f=a((()=>(0,n._)("h2",null,"Points:",-1))),g={key:0},b={class:"editor"},w={class:"controls"},m={class:"multi-control"},x={class:"multi-control"};function y(t,e,o,r,a,y){return(0,n.wg)(),(0,n.iD)("div",d,[l,(0,n._)("div",c,[(0,n._)("div",h,[(0,n._)("div",null,[u,(0,n._)("canvas",{id:o.canvasId,ref:"canvas",width:"500",class:"canvas-style",height:"500",onMousemove:e[0]||(e[0]=(...t)=>y.mouseMove&&y.mouseMove(...t)),onMouseenter:e[1]||(e[1]=(...t)=>y.canvasMouseEnter&&y.canvasMouseEnter(...t)),onMouseleave:e[2]||(e[2]=(...t)=>y.canvasMouseLeave&&y.canvasMouseLeave(...t))},null,40,v)]),(0,n._)("div",p,[f,y.showWinnerText?((0,n.wg)(),(0,n.iD)("ol",g,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.engine.winners,(t=>((0,n.wg)(),(0,n.iD)("li",{key:t.id},[(0,n._)("b",{style:(0,s.j5)(`color: ${t.color}`)},"TRAIL ["+(0,s.zw)(t.id)+"]",5),(0,n.Uk)(" - POINTS: "+(0,s.zw)(t.points),1)])))),128))])):(0,n.kq)("",!0)])]),(0,n._)("div",b,[(0,n._)("div",w,[(0,n._)("div",m,[(0,n._)("button",{class:"btn btn-dark",onClick:e[3]||(e[3]=e=>y.addBot(t.botA))},"ADD [A]"),(0,n.wy)((0,n._)("input",{id:"colorPickerA","onUpdate:modelValue":e[4]||(e[4]=e=>t.botA.color=e),type:"color"},null,512),[[i.nr,t.botA.color]]),(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":e[5]||(e[5]=e=>t.botA.posTxt=e),type:"text",class:"pos-input"},null,512),[[i.nr,t.botA.posTxt]])]),(0,n._)("div",x,[(0,n._)("button",{class:"btn btn-dark",onClick:e[6]||(e[6]=e=>y.addBot(t.botB))},"ADD [B]"),(0,n.wy)((0,n._)("input",{id:"colorPickerB","onUpdate:modelValue":e[7]||(e[7]=e=>t.botB.color=e),type:"color"},null,512),[[i.nr,t.botB.color]]),(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":e[8]||(e[8]=e=>t.botB.posTxt=e),type:"text",class:"pos-input"},null,512),[[i.nr,t.botB.posTxt]])]),(0,n._)("button",{class:"btn btn-dark",onClick:e[9]||(e[9]=(...t)=>y.clear&&y.clear(...t))},"CLEAR"),(0,n._)("button",{class:"btn btn-dark",onClick:e[10]||(e[10]=(...t)=>y.randomizeBots&&y.randomizeBots(...t))},"RANDOM"),(0,n._)("button",{class:"btn btn-dark",onClick:e[11]||(e[11]=(...t)=>y.togglePause&&y.togglePause(...t))},(0,s.zw)(y.pauseBtnText),1),(0,n._)("button",{class:"btn btn-dark",onClick:e[12]||(e[12]=(...t)=>y.step&&y.step(...t))},"STEP"),(0,n._)("button",{class:"btn btn-dark",onClick:e[13]||(e[13]=(...t)=>y.benchmark&&y.benchmark(...t))},"BENCHMARK")]),(0,n.wy)((0,n._)("textarea",{"onUpdate:modelValue":e[14]||(e[14]=e=>t.botA.js=e),class:"code-area",style:(0,s.j5)(`border-color: ${t.botA.color}`)},null,4),[[i.nr,t.botA.js]]),(0,n.wy)((0,n._)("textarea",{"onUpdate:modelValue":e[15]||(e[15]=e=>t.botB.js=e),class:"code-area",style:(0,s.j5)(`border-color: ${t.botB.color}`)},null,4),[[i.nr,t.botB.js]])])])])}o(2262),o(4506);var P=o(9782);class M{constructor(){}static isOccupied(t,e){if(t&&t.length&&t[0].length&&!(e.x>=t.length||e.x<0||e.y<0||!t[e.x]||e.y>=t[e.x].length))return!!t[e.x][e.y].occupied}static flatten(t){return t.map(((t,e)=>t.map(((t,o)=>(t.gridPosition=new Point(e,o),t))))).flatMap((t=>t))}static getRandomValidPos(t){var e=M.flatten(t).filter((t=>!t.occupied));if(!(e.length<1)){var o=e[Math.floor(Math.random()*e.length)].gridPosition;return o}console.log("No open spots to spawn in a tron bike!")}}const T=o(5445);class B{constructor(t){this.canvasId=t,this.reset()}reset(){T.project?.activeLayer?.removeChildren(),T.projects.forEach((t=>{t.remove()})),T.setup(this.canvasId),this.grid=void 0,this.trailStuff={},this.colors=["#A72334","#FC7A43","#ECCF39","#6FAF60","#02654B","#188DBF","#22379B","#7209b7","#f72585"],this.colorIndex=0}convertMousePosToGridPos(t){if(this.grid){var e=M.flatten(this.grid).find((e=>e.hitTest(new P.Point(t.x,t.y))));return e?e.gridPosition:void 0}}render(t){let e=t.grid,o=t.trails;if(!e.expired){if(void 0===this.grid){var i=50;this.grid=e.map(((t,e)=>t.map(((t,o)=>{var n=new T.Path.Rectangle(new T.Point(e*i,o*i),new T.Size(i,i));return n.strokeColor="#444",n.fillColor="#090909",n}))))}for(let t of o){this.trailStuff[t.id]||(this.trailStuff[t.id]={});let e=this.trailStuff[t.id];for(let n of t.tail){let e=this.grid[n.x][n.y];e.fillColor=t.color,e.strokeWidth=1,e.shadowColor="#000",e.shadowBlur=10}e.wireframe||(e.wireframe=new T.Path([...t.tail,t.head].map((t=>this.grid[t.x][t.y].position))),e.wireframe.strokeColor=new T.Color(0,0,0,.25),e.wireframe.strokeWidth=5),e.wireframe.segments.at(-1).x!=t.head.x&&e.wireframe.segments.at(-1).y!=t.head.y&&e.wireframe.add(this.grid[t.head.x][t.head.y].position);let o=this.grid[t.head.x][t.head.y];o.strokeColor=t.color,o.fillColor=t.color,o.strokeWidth=10,o.shadowColor="#000",o.shadowBlur=20,o.bringToFront();let i=e.headIndicator;if(i||(i=new T.Path.Circle(o.position,15),i.fillColor=t.color,i.strokeColor="#FFF",i.strokeWidth=10,e.headIndicator=i),!t.alive&&!e.deadSymbolHead){i.remove();let t=new T.Path.RegularPolygon(o.position,3,25);t.fillColor="#000",t.position=o.position,e.deadSymbolHead=t}e.wireframe.bringToFront(),i.bringToFront(),i.position=o.position,e.deadSymbolHead?.bringToFront()}}}}class C{constructor(t=0,e=0){this.x=+t,this.y=+e}add(t){return new C(this.x+t.x,this.y+t.y)}}const k={colors:["#A72334","#FC7A43","#ECCF39","#6FAF60","#02654B","#188DBF","#22379B","#7209b7","#f72585"],MoveDirection:{UP:new C(0,-1),DOWN:new C(0,1),LEFT:new C(-1,0),RIGHT:new C(1,0)}};class A{constructor(t,e,o,i){this.head=t,this.tail=[],this.color=e,this.id=o,this.getMove=i,this.alive=!0,this.state={}}applyMove(t){this.tail.push(this.head),this.head=t}}class O{static getRandomColorHex(){const t=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;function e(t,e,o){o/=100;const i=e*Math.min(o,1-o)/100,n=e=>{const n=(e+t/30)%12,r=o-i*Math.max(Math.min(n-3,9-n,1),-1);return Math.round(255*r).toString(16).padStart(2,"0")};return`#${n(0)}${n(8)}${n(4)}`}var o=t(0,360),i=t(50,100),n=t(30,70);return e(o,i,n)}}class F{static isValidMove(t,e,o,i){if(!o||void 0==o.x||void 0==o.y)return[!1,["Error - moveDir is not a valid Point object. Killing trail. moveDir supplied:",o]];if(!Object.keys(Constants.MoveDirection).map((t=>Constants.MoveDirection[t])).some((t=>o.x==t.x&&o.y==t.y)))return[!1,["Invalid move supplied! Killing trail. Move supplied: ",o]];let n=new C(e.head.x+o.x,e.head.y+o.y);if(n.x<0||n.x>=t.length||n.y<0||n.y>=t[n.x].length)return[!1,[`%cTRAIL [${e.id}] %ctried to escape the grid! They failed...`,"color: "+e.color,"color: auto"]];if(t[n.x][n.y].occupied){var r=t[n.x][n.y].id,s=i.find((t=>t.id==r));return[!1,[`%cTRAIL [${e.id}] %chit %cTRAIL [${s.id}]`,"color: "+e.color,"color: auto","color: "+s.color]]}return[!0]}}class I{constructor(){window.Constants=k,window.Point=P.Point,window.Grid=M,this.reset()}log(){this.debug&&console.log(...arguments)}reset(){this.debug=!0,this.expired=!1,this.path=null,this.point={x:0,y:0},this.grid=void 0,this.trails=[],this.gridWidth=10,this.colorIndex=0,this.winners=[],this.createGrid()}get allBotsDead(){return this.trails.length&&this.trails.every((t=>!t.alive))}createGrid(){this.grid=[];for(var t=0;t<this.gridWidth;t++){this.grid[t]=[];for(var e=0;e<this.gridWidth;e++){var o={id:void 0,get occupied(){return void 0!=this.id}};this.grid[t].push(o)}}}parseRawJsIntoGetMoveFunction(t){let e=new Function("return getMove; "+t)();return e}addTrail(t,e,o,i){if(this.expired)this.log("Engine has expired - please reset before addinga new bot.");else if(i=i||M.getRandomValidPos(this.grid),i){o=o||O.getRandomColorHex();var n=new A(i,o,e,t);this.trails.push(n),this.setGridCellOwner(n)}}setGridCellOwner(t){this.grid[t.head.x][t.head.y].id=t.id}determineWinners(){if(this.trails.length<1)return;var t=M.flatten(this.grid).filter((t=>t.occupied)).reduce(((t,e)=>(t.has(e.id)||t.set(e.id,{points:0,trail:this.trails.find((t=>t.id==e.id))}),t.get(e.id).points+=1,t)),new Map);if(t.size<1)return void this.log("No winners??");let e=Array.from(t.values()).sort(((t,e)=>e.points-t.points));for(var o of(this.log("\n\n\n"),this.log("#############################"),this.log("##         WINNERS         ##"),this.log("#############################"),e)){let t=o.trail;t.points=o.points,this.log(`%c > %cTRAIL [${t.id}] %c POINTS: ${t.points}`,"color: auto",`color: ${t.color};`,"color: auto"),this.winners.push(t)}this.expired=!0}iterateTrails(){for(let o of this.trails.filter((t=>t.alive))){try{var t=o.getMove(this.grid,o.head,this.trails.map((t=>t.head)),o.state)}catch(e){this.log("Error executing script: ",e,o.getMove)}let[i,n]=F.isValidMove(this.grid,o,t,this.trails);if(!i){o.alive=!1,this.log(...n);continue}let r=o.head.add(t);o.applyMove(r),this.setGridCellOwner(o)}}step(){this.expired||this.allBotsDead||this.iterateTrails(),!this.expired&&this.allBotsDead&&this.determineWinners()}}var _="// Clockwise bot - Example:\nfunction getMove(grid, headPos, heads, state) {\n  var dir = Constants.MoveDirection;\n  if (validMove(grid, headPos, dir.RIGHT)) return dir.RIGHT;\n  if (validMove(grid, headPos, dir.DOWN)) return dir.DOWN;\n  if (validMove(grid, headPos, dir.LEFT)) return dir.LEFT;\n  if (validMove(grid, headPos, dir.UP)) return dir.UP;\n  return dir.RIGHT;\n}\n\nfunction validMove(grid, headPos, move) {\n  var nextPos = new Point(headPos.x + move.x, headPos.y + move.y);\n  var isOccupied = Grid.isOccupied(grid, nextPos);\n  return isOccupied == false; // this works because isOccupied is \n  //    exactly false if the square is free, \n  //    true if occupied, \n  //    undefined if out of bounds\n}",D="// Counter-Clockwise bot - Example:\nfunction getMove(grid, headPos, heads, state) {\n  var dir = Constants.MoveDirection;\n  if (validMove(grid, headPos, dir.LEFT)) return dir.LEFT;\n  if (validMove(grid, headPos, dir.DOWN)) return dir.DOWN;\n  if (validMove(grid, headPos, dir.RIGHT)) return dir.RIGHT;\n  if (validMove(grid, headPos, dir.UP)) return dir.UP;\n  return dir.RIGHT;\n}\n\nfunction validMove(grid, headPos, move) {\n  var nextPos = new Point(headPos.x + move.x, headPos.y + move.y);\n  var isOccupied = Grid.isOccupied(grid, nextPos);\n  return isOccupied == false; // this works because isOccupied is \n  //    exactly false if the square is free, \n  //    true if occupied, \n  //    undefined if out of bounds\n}",R={name:"TronBox",props:{canvasId:{type:String,required:!0}},data:()=>({botA:{js:void 0,color:"#FF0000",prevColor:"#FF0000",posTxt:"0,0",id:"A"},botB:{js:void 0,color:"#0000FF",prevColor:"#0000FF",posTxt:"9,9",id:"B"},renderer:void 0,engine:void 0,paused:!0,mousePos:{x:0,y:0},mouseIsOnCanvas:!1,lastKeyPressed:void 0}),computed:{pauseBtnText:function(){return this.paused?"PLAY":"PAUSE"},showWinnerText:function(){return this.engine?.winners?.length>0}},mounted(){window.addEventListener("keydown",this.keyDown),window.addEventListener("keyup",this.keyUp),this.renderer=new B(this.canvasId),this.engine=new I,this.botA.js=_,this.botB.js=D,this.start()},methods:{convertPosTxtToPoint(t){let[e,o,i]=t.match(/(\d+),(\d+)/);return new C(o,i)},addBot(t,e){let o=this.engine.parseRawJsIntoGetMoveFunction(t.js);e=e||this.convertPosTxtToPoint(t.posTxt),this.engine.addTrail(o,t.id,t.color,e)},clear(){this.engine.reset(),this.renderer.reset()},step(){this.engine.step()},randomizeBots(){this.clear(),this.randomizeBot(this.botA),this.randomizeBot(this.botB),this.addInitialTrails()},randomizeBot(t){t.prevColor=t.color,t.color=O.getRandomColorHex();let e=()=>Math.floor(10*Math.random());t.posTxt=e()+","+e()},addInitialTrails(){this.addBot(this.botA),this.addBot(this.botB)},start(){this.addInitialTrails(),this.loop()},togglePause(){this.paused=!this.paused},canvasMouseEnter(){this.mouseIsOnCanvas=!0},canvasMouseLeave(){this.mouseIsOnCanvas=!1},addBotAtMousePos(t){if(this.mouseIsOnCanvas){var e=this.renderer.convertMousePosToGridPos(this.mousePos);e&&!Grid.isOccupied(this.engine.grid,e)&&this.addBot(t,e)}},keyDown(t){this.lastKeyPressed!=t.key&&(this.lastKeyPressed=t.key,"a"==t.key?this.addBotAtMousePos(this.botA):"b"==t.key&&this.addBotAtMousePos(this.botB))},keyUp(t){this.lastKeyPressed=void 0},mouseMove(t){var e=this.$refs.canvas.getBoundingClientRect();this.mousePos={x:Math.floor(t.clientX-e.left),y:Math.floor(t.clientY-e.top)}},loop(){this.paused||this.engine.step(),this.renderer.render(this.engine),setTimeout(this.loop,50)},async benchmark(){let t=100,e=new Map;for(let s=1;s<=t;s++){this.randomizeBots(),this.engine.debug=!1;let o=this.botA;this.botA=this.botB,this.botB=o;while(!this.engine.expired)await new Promise((t=>{this.engine.step(),t()}));let i=this.engine.winners.filter((t=>t.points==this.engine.winners[0].points));for(let t of i)e.has(t.id)||e.set(t.id,{...t,wins:0}),1==i.length&&e.get(t.id).wins++;console.log(`Running iteration ${s}/${t}`)}console.log("================="),console.log("BENCHMARK RESULTS:");let o=e.get(this.botA.id).wins,i=e.get(this.botB.id).wins,n=(o/t*100).toFixed(1),r=(i/t*100).toFixed(1);console.log(`Bot A wins: ${o}/${t} (${n}%)`),console.log(`Bot B wins: ${i}/${t} (${r}%)`),console.log("      Ties: ",t-(o+i)),this.engine.debug=!0}}},E=o(89);const j=(0,E.Z)(R,[["render",y],["__scopeId","data-v-a7db633e"]]);var S=j,$={name:"App",components:{TronBox:S}};const G=(0,E.Z)($,[["render",r]]);var L=G;o(8937);(0,i.ri)(L).mount("#app")},858:function(){},4158:function(){}},e={};function o(i){var n=e[i];if(void 0!==n)return n.exports;var r=e[i]={exports:{}};return t[i].call(r.exports,r,r.exports,o),r.exports}o.m=t,function(){var t=[];o.O=function(e,i,n,r){if(!i){var s=1/0;for(c=0;c<t.length;c++){i=t[c][0],n=t[c][1],r=t[c][2];for(var a=!0,d=0;d<i.length;d++)(!1&r||s>=r)&&Object.keys(o.O).every((function(t){return o.O[t](i[d])}))?i.splice(d--,1):(a=!1,r<s&&(s=r));if(a){t.splice(c--,1);var l=n();void 0!==l&&(e=l)}}return e}r=r||0;for(var c=t.length;c>0&&t[c-1][2]>r;c--)t[c]=t[c-1];t[c]=[i,n,r]}}(),function(){o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,{a:e}),e}}(),function(){o.d=function(t,e){for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};o.O.j=function(e){return 0===t[e]};var e=function(e,i){var n,r,s=i[0],a=i[1],d=i[2],l=0;if(s.some((function(e){return 0!==t[e]}))){for(n in a)o.o(a,n)&&(o.m[n]=a[n]);if(d)var c=d(o)}for(e&&e(i);l<s.length;l++)r=s[l],o.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return o.O(c)},i=self["webpackChunktronbox"]=self["webpackChunktronbox"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=o.O(void 0,[998],(function(){return o(1307)}));i=o.O(i)})();
//# sourceMappingURL=app.6ab4b5e8.js.map