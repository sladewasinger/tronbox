(function(){var e={4213:function(e,t,o){"use strict";var i=o(9242),r=o(3396);function n(e,t,o,i,n,s){const a=(0,r.up)("TronBox");return(0,r.wg)(),(0,r.j4)(a,{"canvas-id":"grid"})}var s=o(7139);const a=e=>((0,r.dD)("data-v-01dd1b3d"),e=e(),(0,r.Cn)(),e),d={class:"grid-box"},l=a((()=>(0,r._)("div",{class:"header"},[(0,r._)("h1",null,"Battle Tron")],-1))),c={class:"flex-box-row"},h={class:"flex-box-row no-gap"},u=a((()=>(0,r._)("p",{class:"tip"}," Press 'a' or 'b' on the keyboard to place a bot at your mouse position! ",-1))),v=["id"],f={class:"winner-box"},p=a((()=>(0,r._)("h2",null,"Winners:",-1))),g={key:0},b={class:"editor"},y={class:"controls"},w={class:"multi-control"},m={class:"multi-control"};function x(e,t,o,n,a,x){return(0,r.wg)(),(0,r.iD)("div",d,[l,(0,r._)("div",c,[(0,r._)("div",h,[(0,r._)("div",null,[u,(0,r._)("canvas",{id:o.canvasId,ref:"canvas",width:"500",class:"canvas-style",height:"500",onMousemove:t[0]||(t[0]=(...e)=>x.mouseMove&&x.mouseMove(...e)),onMouseenter:t[1]||(t[1]=(...e)=>x.canvasMouseEnter&&x.canvasMouseEnter(...e)),onMouseleave:t[2]||(t[2]=(...e)=>x.canvasMouseLeave&&x.canvasMouseLeave(...e))},null,40,v)]),(0,r._)("div",f,[p,x.showWinnerText?((0,r.wg)(),(0,r.iD)("ol",g,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.engine.winners,(e=>((0,r.wg)(),(0,r.iD)("li",{key:e.id},[(0,r._)("b",{style:(0,s.j5)(`color: ${e.color}`)},"TRAIL ["+(0,s.zw)(e.id)+"]",5),(0,r.Uk)(" - POINTS: "+(0,s.zw)(e.points),1)])))),128))])):(0,r.kq)("",!0)])]),(0,r._)("div",b,[(0,r._)("div",y,[(0,r._)("div",w,[(0,r._)("button",{class:"btn btn-dark",onClick:t[3]||(t[3]=t=>x.addBot(e.botA))},"ADD [A]"),(0,r.wy)((0,r._)("input",{id:"colorPickerA","onUpdate:modelValue":t[4]||(t[4]=t=>e.botA.color=t),type:"color"},null,512),[[i.nr,e.botA.color]])]),(0,r._)("div",m,[(0,r._)("button",{class:"btn btn-dark",onClick:t[5]||(t[5]=t=>x.addBot(e.botB))},"ADD [B]"),(0,r.wy)((0,r._)("input",{id:"colorPickerB","onUpdate:modelValue":t[6]||(t[6]=t=>e.botB.color=t),type:"color"},null,512),[[i.nr,e.botB.color]])]),(0,r._)("button",{class:"btn btn-dark",onClick:t[7]||(t[7]=(...e)=>x.clear&&x.clear(...e))},"CLEAR"),(0,r._)("button",{class:"btn btn-dark",onClick:t[8]||(t[8]=(...e)=>x.reset&&x.reset(...e))},"RANDOM"),(0,r._)("button",{class:"btn btn-dark",onClick:t[9]||(t[9]=(...e)=>x.togglePause&&x.togglePause(...e))},(0,s.zw)(x.pauseBtnText),1),(0,r._)("button",{class:"btn btn-dark",onClick:t[10]||(t[10]=(...e)=>x.step&&x.step(...e))},"STEP")]),(0,r.wy)((0,r._)("textarea",{"onUpdate:modelValue":t[11]||(t[11]=t=>e.botA.js=t),class:"code-area",style:(0,s.j5)(`border-color: ${e.botA.prevColor}`)},null,4),[[i.nr,e.botA.js]]),(0,r.wy)((0,r._)("textarea",{"onUpdate:modelValue":t[12]||(t[12]=t=>e.botB.js=t),class:"code-area",style:(0,s.j5)(`border-color: ${e.botB.prevColor}`)},null,4),[[i.nr,e.botB.js]])])])])}o(2262),o(4506);var P=o(9782);class M{constructor(){}static isOccupied(e,t){if(e&&e.length&&e[0].length&&!(t.x>=e.length||t.x<0||t.y<0||t.y>=e[t.x].length))return!!e[t.x][t.y].occupied}static flatten(e){return e.map(((e,t)=>e.map(((e,o)=>(e.gridPosition=new Point(t,o),e))))).flatMap((e=>e))}}const C=o(5445);class T{constructor(e){this.canvasId=e,this.reset()}reset(){C.project?.activeLayer?.removeChildren(),C.projects.forEach((e=>{console.log("Unexpected project found. Removing..."),e.remove()})),C.setup(this.canvasId),this.grid=void 0,this.trailStuff={},this.colors=["#A72334","#FC7A43","#ECCF39","#6FAF60","#02654B","#188DBF","#22379B","#7209b7","#f72585"],this.colorIndex=0}convertMousePosToGridPos(e){if(this.grid){var t=M.flatten(this.grid).find((t=>t.hitTest(new P.Point(e.x,e.y))));return t?t.gridPosition:void 0}}render(e,t){if(void 0===this.grid){var o=50;this.grid=e.map(((e,t)=>e.map(((e,i)=>{var r=new C.Path.Rectangle(new C.Point(t*o,i*o),new C.Size(o,o));return r.strokeColor="#444",r.fillColor="#090909",r}))))}for(let i of t){this.trailStuff[i.id]||(this.trailStuff[i.id]={});let e=this.trailStuff[i.id];for(let r of i.tail){let e=this.grid[r.x][r.y];e.fillColor=i.color,e.strokeWidth=1,e.shadowColor="#000",e.shadowBlur=10}e.wireframe||(e.wireframe=new C.Path([...i.tail,i.head].map((e=>this.grid[e.x][e.y].position))),e.wireframe.strokeColor=new C.Color(0,0,0,.25),e.wireframe.strokeWidth=5),e.wireframe.segments.at(-1).x!=i.head.x&&e.wireframe.segments.at(-1).y!=i.head.y&&e.wireframe.add(this.grid[i.head.x][i.head.y].position);let t=this.grid[i.head.x][i.head.y];t.strokeColor=i.color,t.fillColor=i.color,t.strokeWidth=10,t.shadowColor="#000",t.shadowBlur=20,t.bringToFront();let o=e.headIndicator;if(o||(o=new C.Path.Circle(t.position,15),o.fillColor=i.color,o.strokeColor="#FFF",o.strokeWidth=10,e.headIndicator=o),!i.alive&&!e.deadSymbolHead){o.remove();let i=new C.Path.RegularPolygon(t.position,3,25);i.fillColor="#000",i.position=t.position,e.deadSymbolHead=i}e.wireframe.bringToFront(),o.bringToFront(),o.position=t.position,e.deadSymbolHead?.bringToFront()}}}class k{constructor(e=0,t=0){this.x=e,this.y=t}add(e){return new k(this.x+e.x,this.y+e.y)}}const O={colors:["#A72334","#FC7A43","#ECCF39","#6FAF60","#02654B","#188DBF","#22379B","#7209b7","#f72585"],MoveDirection:{UP:new k(0,-1),DOWN:new k(0,1),LEFT:new k(-1,0),RIGHT:new k(1,0)}};class I{constructor(e,t,o,i){this.head=e,this.tail=[],this.color=t,this.id=o,this.getMove=i,this.alive=!0,this.state={}}applyMove(e){this.tail.push(this.head),this.head=e}}class B{static getRandomColorHex(){const e=(e,t)=>Math.floor(Math.random()*(t-e+1))+e;function t(e,t,o){o/=100;const i=t*Math.min(o,1-o)/100,r=t=>{const r=(t+e/30)%12,n=o-i*Math.max(Math.min(r-3,9-r,1),-1);return Math.round(255*n).toString(16).padStart(2,"0")};return`#${r(0)}${r(8)}${r(4)}`}var o=e(0,360),i=e(50,100),r=e(30,70);return t(o,i,r)}}class A{static isValidMove(e,t,o,i){if(!o||void 0==o.x||void 0==o.y)return console.log("Error - moveDir is not a valid Point object. Killing trail. moveDir supplied:",o),!1;if(!Object.keys(Constants.MoveDirection).map((e=>Constants.MoveDirection[e])).some((e=>o.x==e.x&&o.y==e.y)))return console.log("Invalid move supplied! Killing trail. Move supplied: ",o),!1;let r=new Point(t.head.x+o.x,t.head.y+o.y);if(r.x<0||r.x>=e.length||r.y<0||r.y>=e[r.x].length)return console.log(`%cTRAIL [${t.id}] %ctried to escape the grid! They failed...`,"color: "+t.color,"color: auto"),!1;if(e[r.x][r.y].occupied){var n=e[r.x][r.y].id,s=i.find((e=>e.id==n));return console.log(`%cTRAIL [${t.id}] %chit %cTRAIL [${s.id}]`,"color: "+t.color,"color: auto","color: "+s.color),!1}return!0}}class F{constructor(){window.Constants=O,window.Point=P.Point,window.Grid=M,this.reset()}reset(){this.expired=!1,this.path=null,this.point={x:0,y:0},this.grid=void 0,this.trails=[],this.gridWidth=10,this.colorIndex=0,this.winners=[],this.createGrid()}get allBotsDead(){return this.trails.length&&this.trails.every((e=>!e.alive))}createGrid(){this.grid=[];for(var e=0;e<this.gridWidth;e++){this.grid[e]=[];for(var t=0;t<this.gridWidth;t++){var o={id:void 0,get occupied(){return void 0!=this.id}};this.grid[e].push(o)}}}parseRawJsIntoGetMoveFunction(e){let t=new Function("return getMove; "+e)();return t}getRandomValidPos(){var e=M.flatten(this.grid).filter((e=>!e.occupied));if(!(e.length<1)){var t=e[Math.floor(Math.random()*e.length)].gridPosition;return t}console.log("No open spots to spawn in a tron bike!")}addTrail(e,t,o){if(this.expired)console.log("Engine has expired - please reset before addinga new bot.");else if(o=o||this.getRandomValidPos(),o){t=t||B.getRandomColorHex();var i=this.trails.length,r=new I(o,t,i,e);this.trails.push(r),this.setGridCellOwner(r)}}setGridCellOwner(e){this.grid[e.head.x][e.head.y].id=e.id}determineWinners(){if(this.trails.length<1)return;var e=M.flatten(this.grid).filter((e=>e.occupied)).reduce(((e,t)=>(e[t.id]||(e[t.id]={points:0,id:t.id}),e[t.id].points+=1,e)),{});if(Object.keys(e).length<1)return;let t=Object.keys(e).map((t=>e[t])).sort(((e,t)=>t.points-e.points))[0].points,o=Object.keys(e).map((t=>e[t])).filter((e=>e.points==t));for(var i of Object.keys(e).map((t=>e[t])))console.log(`TRAIL [${i.id}] has ${i.points} points.`);console.log("\n\n\n"),console.log("#############################"),console.log("##         WINNERS         ##"),console.log("#############################");var r="WON";for(var n of(o.length>1&&(console.log(" -- IT'S A TIE! -- "),r="TIED"),o)){let e=this.trails.find((e=>e.id==n.id));e.points=n.points,console.log(`%c!!!! %cTRAIL [${e.id}] %c${r} WITH ${n.points} POINTS!!!!`,"color: auto",`color: ${e.color};`,"color: auto"),this.winners.push(e)}this.expired=!0}iterateTrails(){for(let o of this.trails.filter((e=>e.alive))){try{var e=o.getMove(this.grid,o.head,this.trails.map((e=>e.head)),o.state)}catch(t){console.log("Error executing script: ",t,o.getMove)}if(!A.isValidMove(this.grid,o,e,this.trails)){o.alive=!1;continue}let i=o.head.add(e);o.applyMove(i),this.setGridCellOwner(o)}}step(){this.expired||this.allBotsDead||this.iterateTrails(),!this.expired&&this.allBotsDead&&this.determineWinners()}}var j="// Clockwise bot - Example:\nfunction getMove(grid, headPos, heads, state) {\n  var dir = Constants.MoveDirection;\n  if (validMove(grid, headPos, dir.RIGHT)) return dir.RIGHT;\n  if (validMove(grid, headPos, dir.DOWN)) return dir.DOWN;\n  if (validMove(grid, headPos, dir.LEFT)) return dir.LEFT;\n  if (validMove(grid, headPos, dir.UP)) return dir.UP;\n  return dir.RIGHT;\n}\n\nfunction validMove(grid, headPos, move) {\n  var nextPos = new Point(headPos.x + move.x, headPos.y + move.y);\n  var isOccupied = Grid.isOccupied(grid, nextPos);\n  return isOccupied == false; // this works because isOccupied is \n  //    exactly false if the square is free, \n  //    true if occupied, \n  //    undefined if out of bounds\n}",D="// Counter-Clockwise bot - Example:\nfunction getMove(grid, headPos, heads, state) {\n  var dir = Constants.MoveDirection;\n  if (validMove(grid, headPos, dir.LEFT)) return dir.LEFT;\n  if (validMove(grid, headPos, dir.DOWN)) return dir.DOWN;\n  if (validMove(grid, headPos, dir.RIGHT)) return dir.RIGHT;\n  if (validMove(grid, headPos, dir.UP)) return dir.UP;\n  return dir.RIGHT;\n}\n\nfunction validMove(grid, headPos, move) {\n  var nextPos = new Point(headPos.x + move.x, headPos.y + move.y);\n  var isOccupied = Grid.isOccupied(grid, nextPos);\n  return isOccupied == false; // this works because isOccupied is \n  //    exactly false if the square is free, \n  //    true if occupied, \n  //    undefined if out of bounds\n}",_={name:"TronBox",props:{canvasId:{type:String,required:!0}},data:()=>({botA:{js:void 0,color:"#FF0000",prevColor:"#FF0000"},botB:{js:void 0,color:"#0000FF",prevColor:"#0000FF"},renderer:void 0,engine:void 0,paused:!0,mousePos:{x:0,y:0},mouseIsOnCanvas:!1,lastKeyPressed:void 0}),computed:{pauseBtnText:function(){return this.paused?"PLAY":"PAUSE"},showWinnerText:function(){return this.engine?.winners?.length>0}},mounted(){window.addEventListener("keydown",this.keyDown),window.addEventListener("keyup",this.keyUp),this.renderer=new T(this.canvasId),this.engine=new F,this.botA.js=j,this.botB.js=D,this.start()},methods:{addBot(e,t){let o=this.engine.parseRawJsIntoGetMoveFunction(e.js);this.engine.addTrail(o,e.color,t),e.prevColor=e.color,e.color=B.getRandomColorHex()},clear(){this.engine.reset(),this.renderer.reset()},step(){this.engine.step()},reset(){this.clear(),this.addInitialTrails()},addInitialTrails(){this.addBot(this.botA),this.addBot(this.botB)},start(){this.addInitialTrails(),this.loop()},togglePause(){this.paused=!this.paused},canvasMouseEnter(){this.mouseIsOnCanvas=!0},canvasMouseLeave(){this.mouseIsOnCanvas=!1},addBotAtMousePos(e){if(this.mouseIsOnCanvas){var t=this.renderer.convertMousePosToGridPos(this.mousePos);t&&!Grid.isOccupied(this.engine.grid,t)&&this.addBot(e,t)}},keyDown(e){this.lastKeyPressed!=e.key&&(this.lastKeyPressed=e.key,"a"==e.key?this.addBotAtMousePos(this.botA):"b"==e.key&&this.addBotAtMousePos(this.botB))},keyUp(e){this.lastKeyPressed=void 0},mouseMove(e){var t=this.$refs.canvas.getBoundingClientRect();this.mousePos={x:Math.floor(e.clientX-t.left),y:Math.floor(e.clientY-t.top)}},loop(){this.paused||this.engine.step(),this.renderer.render(this.engine.grid,this.engine.trails),setTimeout(this.loop,50)}}},R=o(89);const E=(0,R.Z)(_,[["render",x],["__scopeId","data-v-01dd1b3d"]]);var S=E,G={name:"App",components:{TronBox:S}};const W=(0,R.Z)(G,[["render",n]]);var L=W;o(8937);(0,i.ri)(L).mount("#app")},858:function(){},4158:function(){}},t={};function o(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,o),n.exports}o.m=e,function(){var e=[];o.O=function(t,i,r,n){if(!i){var s=1/0;for(c=0;c<e.length;c++){i=e[c][0],r=e[c][1],n=e[c][2];for(var a=!0,d=0;d<i.length;d++)(!1&n||s>=n)&&Object.keys(o.O).every((function(e){return o.O[e](i[d])}))?i.splice(d--,1):(a=!1,n<s&&(s=n));if(a){e.splice(c--,1);var l=r();void 0!==l&&(t=l)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[i,r,n]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};o.O.j=function(t){return 0===e[t]};var t=function(t,i){var r,n,s=i[0],a=i[1],d=i[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(r in a)o.o(a,r)&&(o.m[r]=a[r]);if(d)var c=d(o)}for(t&&t(i);l<s.length;l++)n=s[l],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return o.O(c)},i=self["webpackChunktronbox"]=self["webpackChunktronbox"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=o.O(void 0,[998],(function(){return o(4213)}));i=o.O(i)})();
//# sourceMappingURL=app.fac73ad8.js.map